"use strict";(self.webpackChunkcoding_standard=self.webpackChunkcoding_standard||[]).push([[817],{3905:function(e,r,t){t.d(r,{Zo:function(){return u},kt:function(){return h}});var n=t(7294);function a(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function o(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?o(Object(t),!0).forEach((function(r){a(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function s(e,r){if(null==e)return{};var t,n,a=function(e,r){if(null==e)return{};var t,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],r.indexOf(t)>=0||(a[t]=e[t]);return a}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=n.createContext({}),c=function(e){var r=n.useContext(l),t=r;return e&&(t="function"==typeof e?e(r):i(i({},r),e)),t},u=function(e){var r=c(e.components);return n.createElement(l.Provider,{value:r},e.children)},d={inlineCode:"code",wrapper:function(e){var r=e.children;return n.createElement(n.Fragment,{},r)}},p=n.forwardRef((function(e,r){var t=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=c(t),h=a,g=p["".concat(l,".").concat(h)]||p[h]||d[h]||o;return t?n.createElement(g,i(i({ref:r},u),{},{components:t})):n.createElement(g,i({ref:r},u))}));function h(e,r){var t=arguments,a=r&&r.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=p;var s={};for(var l in r)hasOwnProperty.call(r,l)&&(s[l]=r[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var c=2;c<o;c++)i[c]=t[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,t)}p.displayName="MDXCreateElement"},3768:function(e,r,t){t.r(r),t.d(r,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return c},toc:function(){return u},default:function(){return p}});var n=t(7462),a=t(3366),o=(t(7294),t(3905)),i=["components"],s={sidebar_position:3},l="Error Handling",c={unversionedId:"error-handling-practices/error-handling",id:"error-handling-practices/error-handling",isDocsHomePage:!1,title:"Error Handling",description:"Use Async-Await or promises for async error handling",source:"@site/docs/error-handling-practices/error-handling.md",sourceDirName:"error-handling-practices",slug:"/error-handling-practices/error-handling",permalink:"/coding-standard/docs/error-handling-practices/error-handling",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/error-handling-practices/error-handling.md",version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Coding Standard",permalink:"/coding-standard/docs/general-coding-guidelines/coding-standard"},next:{title:"Testing",permalink:"/coding-standard/docs/testing/testring-and-overall-quality-practice"}},u=[{value:"Use Async-Await or promises for async error handling",id:"use-async-await-or-promises-for-async-error-handling",children:[]},{value:"Use only the built-in Error object",id:"use-only-the-built-in-error-object",children:[]},{value:"Distinguish operational vs programmer errors",id:"distinguish-operational-vs-programmer-errors",children:[]},{value:"Handle errors centrally, not within a middleware",id:"handle-errors-centrally-not-within-a-middleware",children:[]},{value:"Document API errors using Swagger or GraphQL",id:"document-api-errors-using-swagger-or-graphql",children:[]},{value:"Exit the process gracefully when a stranger comes to town",id:"exit-the-process-gracefully-when-a-stranger-comes-to-town",children:[]},{value:"Use a mature logger to increase error visibility",id:"use-a-mature-logger-to-increase-error-visibility",children:[]},{value:"Test error flows using your favorite test framework",id:"test-error-flows-using-your-favorite-test-framework",children:[]},{value:"Discover errors and downtime using APM products",id:"discover-errors-and-downtime-using-apm-products",children:[]},{value:"Catch unhandled promise rejections",id:"catch-unhandled-promise-rejections",children:[]},{value:"Fail fast, validate arguments using a dedicated library",id:"fail-fast-validate-arguments-using-a-dedicated-library",children:[]},{value:"Always await promises before returning to avoid a partial stacktrace",id:"always-await-promises-before-returning-to-avoid-a-partial-stacktrace",children:[]}],d={toc:u};function p(e){var r=e.components,t=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,n.Z)({},d,t,{components:r,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"error-handling"},"Error Handling"),(0,o.kt)("h2",{id:"use-async-await-or-promises-for-async-error-handling"},"Use Async-Await or promises for async error handling"),(0,o.kt)("p",null,"Handling async errors in callback style is probably the fastest way to hell (a.k.a the pyramid of doom). The best gift you can give to your code is using a reputable promise library or async-await instead which enables a much more compact and familiar code syntax like try-catch"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Otherwise:")," Node.js callback style, function(err, response), is a promising way to un-maintainable code due to the mix of error handling with casual code, excessive nesting, and awkward coding patterns"),(0,o.kt)("br",null),(0,o.kt)("h2",{id:"use-only-the-built-in-error-object"},"Use only the built-in Error object"),(0,o.kt)("p",null," Many throw errors as a string or as some custom type \u2013 this complicates the error handling logic and the interoperability between modules. Whether you reject a promise, throw an exception or emit an error \u2013 using only the built-in Error object (or an object that extends the built-in Error object) will increase uniformity and prevent loss of information. There is ",(0,o.kt)("inlineCode",{parentName:"p"},"no-throw-literal")," ESLint rule that strictly checks that (although it have some ",(0,o.kt)("a",{parentName:"p",href:"https://eslint.org/docs/rules/no-throw-literal"},"limitations")," which can be solved when using TypeScript and setting the ",(0,o.kt)("inlineCode",{parentName:"p"},"@typescript-eslint/no-throw-literal")," rule)"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Otherwise:")," When invoking some component, being uncertain which type of errors come in return \u2013 it makes proper error handling much harder. Even worse, using custom types to describe errors might lead to loss of critical error information like the stack trace!"),(0,o.kt)("br",null),(0,o.kt)("h2",{id:"distinguish-operational-vs-programmer-errors"},"Distinguish operational vs programmer errors"),(0,o.kt)("p",null,"Operational errors (e.g. API received an invalid input) refer to known cases where the error impact is fully understood and can be handled thoughtfully. On the other hand, programmer error (e.g. trying to read an undefined variable) refers to unknown code failures that dictate to gracefully restart the application"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Otherwise:")," You may always restart the application when an error appears, but why let ~5000 online users down because of a minor, predicted, operational error? the opposite is also not ideal \u2013 keeping the application up when an unknown issue (programmer error) occurred might lead to an unpredicted behavior. Differentiating the two allows acting tactfully and applying a balanced approach based on the given context"),(0,o.kt)("br",null),(0,o.kt)("h2",{id:"handle-errors-centrally-not-within-a-middleware"},"Handle errors centrally, not within a middleware"),(0,o.kt)("p",null," Error handling logic such as mail to admin and logging should be encapsulated in a dedicated and centralized object that all endpoints (e.g. Express middleware, cron jobs, unit-testing) call when an error comes in"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Otherwise:")," Not handling errors within a single place will lead to code duplication and probably to improperly handled errors"),(0,o.kt)("br",null),(0,o.kt)("h2",{id:"document-api-errors-using-swagger-or-graphql"},"Document API errors using Swagger or GraphQL"),(0,o.kt)("p",null," Let your API callers know which errors might come in return so they can handle these thoughtfully without crashing. For RESTful APIs, this is usually done with documentation frameworks like Swagger. If you're using GraphQL, you can utilize your schema and comments as well."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Otherwise:")," An API client might decide to crash and restart only because it received back an error it couldn\u2019t understand. Note: the caller of your API might be you (very typical in a microservice environment)"),(0,o.kt)("br",null),(0,o.kt)("h2",{id:"exit-the-process-gracefully-when-a-stranger-comes-to-town"},"Exit the process gracefully when a stranger comes to town"),(0,o.kt)("p",null," When an unknown error occurs (a developer error, see best practice 2.3) - there is uncertainty about the application healthiness. Common practice suggests restarting the process carefully using a process management tool like ",(0,o.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/forever"},"Forever")," or ",(0,o.kt)("a",{parentName:"p",href:"http://pm2.keymetrics.io/"},"PM2")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Otherwise:")," When an unfamiliar exception occurs, some object might be in a faulty state (e.g. an event emitter which is used globally and not firing events anymore due to some internal failure) and all future requests might fail or behave crazily"),(0,o.kt)("br",null),(0,o.kt)("h2",{id:"use-a-mature-logger-to-increase-error-visibility"},"Use a mature logger to increase error visibility"),(0,o.kt)("p",null," A set of mature logging tools like ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/pinojs/pino"},"Pino")," or ",(0,o.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/log4js"},"Log4js"),", will speed-up error discovery and understanding. So forget about console.log"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Otherwise:")," Skimming through console.logs or manually through messy text file without querying tools or a decent log viewer might keep you busy at work until late"),(0,o.kt)("br",null),(0,o.kt)("h2",{id:"test-error-flows-using-your-favorite-test-framework"},"Test error flows using your favorite test framework"),(0,o.kt)("p",null,' Whether professional automated QA or plain manual developer testing \u2013 Ensure that your code not only satisfies positive scenarios but also handles and returns the right errors. Testing frameworks like Mocha & Chai can handle this easily (see code examples within the "Gist popup")'),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Otherwise:")," Without testing, whether automatically or manually, you can\u2019t rely on your code to return the right errors. Without meaningful errors \u2013 there\u2019s no error handling"),(0,o.kt)("br",null),(0,o.kt)("h2",{id:"discover-errors-and-downtime-using-apm-products"},"Discover errors and downtime using APM products"),(0,o.kt)("p",null," Monitoring and performance products (a.k.a APM) proactively gauge your codebase or API so they can automagically highlight errors, crashes, and slow parts that you were missing"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Otherwise:")," You might spend great effort on measuring API performance and downtimes, probably you\u2019ll never be aware which are your slowest code parts under real-world scenario and how these affect the UX"),(0,o.kt)("br",null),(0,o.kt)("h2",{id:"catch-unhandled-promise-rejections"},"Catch unhandled promise rejections"),(0,o.kt)("p",null," Any exception thrown within a promise will get swallowed and discarded unless a developer didn\u2019t forget to explicitly handle it. Even if your code is subscribed to ",(0,o.kt)("inlineCode",{parentName:"p"},"process.uncaughtException"),"! Overcome this by registering to the event ",(0,o.kt)("inlineCode",{parentName:"p"},"process.unhandledRejection")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Otherwise:")," Your errors will get swallowed and leave no trace. Nothing to worry about"),(0,o.kt)("br",null),(0,o.kt)("h2",{id:"fail-fast-validate-arguments-using-a-dedicated-library"},"Fail fast, validate arguments using a dedicated library"),(0,o.kt)("p",null," Assert API input to avoid nasty bugs that are much harder to track later. The validation code is usually tedious unless you are using a very cool helper library like ",(0,o.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/ajv"},"ajv")," and ",(0,o.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/joi"},"Joi")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Otherwise:")," Consider this \u2013 your function expects a numeric argument \u201cDiscount\u201d which the caller forgets to pass, later on, your code checks if Discount!=0 (amount of allowed discount is greater than zero), then it will allow the user to enjoy a discount. OMG, what a nasty bug. Can you see it?"),(0,o.kt)("br",null),(0,o.kt)("h2",{id:"always-await-promises-before-returning-to-avoid-a-partial-stacktrace"},"Always await promises before returning to avoid a partial stacktrace"),(0,o.kt)("p",null,"Always do ",(0,o.kt)("inlineCode",{parentName:"p"},"return await")," when returning a promise to benefit full error stacktrace. If a\nfunction returns a promise, that function must be declared as ",(0,o.kt)("inlineCode",{parentName:"p"},"async")," function and explicitly\n",(0,o.kt)("inlineCode",{parentName:"p"},"await")," the promise before returning it"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Otherwise:")," The function that returns a promise without awaiting won't appear in the stacktrace.\nSuch missing frames would probably complicate the understanding of the flow that leads to the error,\nespecially if the cause of the abnormal behavior is inside of the missing function"),(0,o.kt)("br",null))}p.isMDXComponent=!0}}]);